<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>智儒博学</title>
    <meta name="renderer" content="webkit" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta content="width=1920,user-scalable=no" name="viewport" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta name="author" content="wp" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="keywords" content="智儒博学" />
    <meta name="description" content="北京智儒博学教育科技有限公司" />
    <link rel="stylesheet" href="http://cs.zhiruboxue.com//static/index/css/reset.css">
    <link rel="stylesheet" href="http://cs.zhiruboxue.com//static/index/css/normalize.css">
    <link rel="stylesheet" href="http://cs.zhiruboxue.com//static/lib/layui/css/layui.css">
    <link rel="stylesheet" href="http://cs.zhiruboxue.com//static/index/css/register.css">
</head>
<body>
<div class="registerback">
    <div class="register">
        <div class="wrap"><img src="http://cs.zhiruboxue.com//static/index/images/logo.png" alt=""></div>
        <div class="registermain">
            <div class="b-title"><h2>用户注册</h2></div>
            <div class="ct-inner">
                <form id="myform">
                    <div class="regist-form">
                        <ul class="form-list">
                            <li>
                                <div class="form-input">
                                    <div class="fm-dropdown" data-id="countryCode" data-country-name="CN" data-country-code="86">
                                        <label class="input-tips J-placeholder" style="display: none;">手机号码</label>
                                        <input type="text" class="input-mobile qc-log-input-text" name="username" placeholder="手机号码" id="phoneInput" style="padding-left: 10px" now="0"></div>
                                </div>
                            </li>
                            <li>
                                <div class="form-input">
                                    <div class="form-unit">
                                        <label class="input-tips J-placeholder" style="display: none;">密码</label>
                                        <input type="password" class="qc-log-input-text lg" name="password" placeholder="密码" id="passwordInput"></div>
                                </div>
                            </li>
                            <li>
                                <div class="form-input">
                                    <div class="form-unit">
                                        <label class="input-tips J-placeholder" style="display: none;">确认密码</label>
                                        <input type="password" class="qc-log-input-text lg" name="agapassword" placeholder="确认密码" id="confirmPasswordInput"></div>
                                </div>
                            </li>
                            <li>
                                <div class="form-input fm-verify">
                                    <div class="form-unit">
                                        <label class="input-tips J-placeholder" style="display: none;">验证码</label>
                                        <input type="text" class="qc-log-input-text" name="smscode" placeholder="验证码" id="smsCodeInput">
                                        <button type="button" class="qc-log-btn xl getCode" id="TencentCaptcha" data-appid="2054592592" data-cbfn="callback" style="display: none;">获取验证码</button>
                                        <button type="button" class="qc-log-btn xl getCode getcodeadd" data-cbfn="callback">获取验证码</button>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="form-ctrl-label-wrap">
                        <label class="form-ctrl-label">
                            <input id="agree" type="checkbox" checked="" class="qc-log-checkbox J-agreement" value="1">
                            <span>我已阅读并同意
                              <a class="link">智儒博学服务协议</a>和
                              <a class="link">智儒博学隐私声明</a>
                            </span>
                        </label>
                    </div>
                    <div class="op-btn">
                        <button type="button" class="qc-log-btn lg" id="commit">同意协议并提交</button>
                    </div>
                </form>
            </div>
            <div class="regist" style="margin-top: 0">
                <p class="tag-line">已有账号？
                    <a href="http://cs.zhiruboxue.com//index.php/index/index/login" class="link">立即登录</a></p>
            </div>
        </div>
    </div>
</div>
<script src="http://cs.zhiruboxue.com//static/lib/jquery/jquery-1.11.3.min.js"></script>
<script src="http://cs.zhiruboxue.com//static/lib/layui/layui.js"></script>
<script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
<script>
    layui.use(['layer'], function() {
        var layer = layui.layer;
    });
// 滑动的验证码
//  window.callback = function(res){
//     if(res.ret === 0){
//     $.ajax({  
//       type: "GET",  
//       url: "/index.php/index/RegisterAPI/codecheck.html",  
//       data: {"Ticket":res.ticket,"Randstr":res.randstr},
//       dataType: 'json',
//       success: function (res)
//       {
//          if(res==1){
//            $('#TencentCaptcha').css('display','none');
//             $('.getcodeadd').css('display','inline-block');
//          }
//       }
//     });
//   }
// }

var smsCodeInput1 = 100000;
    function reg1() {
    	 $.post('http://cs.zhiruboxue.com/index.php/index/Register/code_check',{'code':smsCodeInput1++},function(mas){
             if(mas==1){
                 var data=$("#myform").serialize();
                 $.post('http://cs.zhiruboxue.com/index.php/index/Register/saveuserinfo',data,function(res){
                     if(res==-1){
                         layer.msg('注册失败');
                         reg1();
                     }else{
                          console.log(111111)
                                 layer.msg('注册成功',function(){
                                     window.location.href="/";
                                 })
                     }
                 })
             }else{
             	layer.msg('验证码错误');
             	reg1();
             }


         })
    }
    // 判断是够注册过
    var phone,password,repassword,wait=60;
;
    $("#phoneInput").blur(function(){
    	phone=$("#phoneInput").val();
    	if(phone==''){
            layer.msg('请输入手机号');
        }else{
        $.ajax({
            url:'http://cs.zhiruboxue.com/index.php/index/Register/is_register',
            data:{'username':phone},
            type:'post',
            dataType:'json',
            success:function(data){
                if(data==1){
                    layer.msg('您已经注册,可以直接登录',{icon: 2});
                    $('.getcodeadd').attr("disabled","disabled");   
                }else if(data==-1){
                	console.log('phone')
                	$('.getcodeadd').attr("disabled",false);  
                }
                 console.log(phone)
            }
        })
       }

    });
    $(".getcodeadd").click(function(){
         phone=$("#phoneInput").val();
         password=$("#passwordInput").val();
        smsCodeInput=$("#smsCodeInput").val();
         repassword=$("#confirmPasswordInput").val();
    var reg=/^(((13[0-9]{1})|(14[0-9]{1})|(17[0]{1})|(19[0-9]{1})|(16[0-9]{1})|(17[0-9]{1})|(15[0-3]{1})|(15[5-9]{1})|(18[0-9]{1}))+\d{8})$/;
        if(phone==''){
            layer.msg('请输入手机号');
        }else if(phone.length!=11){
            layer.msg('您输入的不是有效电话号码');
        }else if(!reg.test(phone)){
            layer.msg('请输入有效手机号码');
        }else if(password==''){
            layer.msg('请输入密码');
        }else if(repassword==''){
            layer.msg('请确认输入密码')
        }else if(password!=repassword){
            layer.msg('两次输入不一致')
        }else{
        time(this);
        $.ajax({
            url:'http://cs.zhiruboxue.com/index.php/index/Register/send_register_sms',
            data:{'phone':phone},
            type:'post',
            dataType:'json',
            success:function(res){
                if(res==0){
                    layer.msg('验证码错误')
                }else if(res==-1){
                    layer.msg('60s内不得重新发送')
                }else if(res==-3){
                    layer.msg('一小时内只能发送3次')
                }else if(res==-2){
                    layer.msg('达到今日发送上限')
                }

            }
        })
		}
    });

// 倒计时60s
		function time(o){
            if (wait==0) {
                o.removeAttribute("disabled");    
                o.innerHTML="获取验证码";
                o.style.backgroundColor="#333";
                wait=60;
            }else{
                o.setAttribute("disabled", true);
                o.innerHTML=wait+"秒后重新获取";
                o.style.backgroundColor="#8f8b8b";
                wait--;
                setTimeout(function(){
                    time(o)
                },1000)
            }
        }



    $("#agree").click(function(){
        var agerr=$("#agree").val();
        if(agerr==1){
            $('#commit').attr("disabled","disabled");
            $('#commit').addClass("agreeclass");
            $("#agree").val(2);
        }else{
            $('#commit').attr("disabled",false);
            $('#commit').removeClass("agreeclass");
            $("#agree").val(1);
        }
    });

    $("#commit").click(function(){
        phone=$("#phoneInput").val();
        password=$("#passwordInput").val();
        smsCodeInput=$("#smsCodeInput").val();
        repassword=$("#confirmPasswordInput").val();
        var reg=/^(((13[0-9]{1})|(14[0-9]{1})|(17[0]{1})|(19[0-9]{1})|(16[0-9]{1})|(17[0-9]{1})|(15[0-3]{1})|(15[5-9]{1})|(18[0-9]{1}))+\d{8})$/;
        if(phone==''){
            layer.msg('请输入手机号');
        }else if(phone.length!=11){
            layer.msg('您输入的不是11位有效电话号码');
        }else if(!reg.test(phone)){
            layer.msg('请输入有效手机号码');
        }else if(password==''){
            layer.msg('请输入密码');
        }else if(repassword==''){
            layer.msg('请确认输入密码')
        }else if(password!=repassword){
            layer.msg('两次输入不一致')
        }else if(smsCodeInput==''){
            layer.msg('请输入验证码')
        }else{
           
        	reg1();
        }
    });
    
</script>
</body>
</html>